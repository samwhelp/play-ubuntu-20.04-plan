#!/usr/bin/env bash


wallpaper_boot_simple () {
	feh --bg-scale $(cat "$HOME/.config/bspwm/wallpaper/wallpaper-fallback.conf") &
}

wallpaper_boot_default () {

	local config_dir_path="$HOME/.config/bspwm/wallpaper/theme/default/config/on"

	wallpaper_boot_util_start_v1 "$config_dir_path"
	##wallpaper_boot_util_start_v2 "$config_dir_path"

}

wallpaper_boot_by_check_fehbg () {

	local load_last="$HOME/.fehbg"

	if [ -x "$HOME/.fehbg" ]; then
		##echo 1
		$load_last
		return 0
	fi

	##echo 2

	wallpaper_boot_by_option
}

wallpaper_boot_by_option () {
	local config_dir_path


	config_dir_path="$(wallpaper_boot_theme_config_dir_path)"
	config_dir_path_check_exist="$?"

	if [ "$config_dir_path_check_exist" = "1" ]  ; then
		## not exists
		wallpaper_boot_simple
		return 0;
	fi


	wallpaper_boot_util_start_v1 "$config_dir_path"
	##wallpaper_boot_util_start_v2 "$config_dir_path"

}


wallpaper_boot_util_start_v1 () {
	local config_dir_path="$1"
	local conf

	##for conf in "$config_dir_path"/*.conf ; do
	for conf in "$config_dir_path"/main.conf ; do
		#echo $conf
		feh --bg-scale $(cat "$conf") &
	done

}

wallpaper_boot_util_start_v2 () {
	local config_dir_path="$1"
	local conf

	##for conf in $(find "$config_dir_path" -name *.conf); do
	for conf in $(find "$config_dir_path" -name main.conf); do
		#echo $conf
		feh --bg-scale $(cat "$conf") &
	done

}

wallpaper_boot_theme_config_dir_path () {
	local theme_dir_path="$(wallpaper_boot_theme_dir_path)"
	local theme_config_dir_path="$theme_dir_path/config/on"

	if [ -d "$theme_config_dir_path" ] ; then
		echo "$theme_config_dir_path"
		return 0
	fi

	echo "$theme_dir_path"
	return 1

}

wallpaper_boot_theme_dir_path () {
	local theme_dir_path


	theme_dir_path="$(wallpaper_boot_theme_dir_path_find_by_option)"

	if [ -d "$theme_dir_path" ] ; then
		echo "$theme_dir_path"
		return 0
	fi


	theme_dir_path="$(wallpaper_boot_theme_dir_path_find_by_default)"

	if [ -d "$theme_dir_path" ] ; then
		echo "$theme_dir_path"
		return 0
	fi


	theme_dir_path="$HOME/.config/wallpaper"
	echo "$theme_dir_path"
	return 0

}

wallpaper_boot_theme_dir_path_find_by_option () {
	## ~/.config/bspwm/wallpaper/theme/some_theme
	wallpaper_boot_theme_dir_path_create $(wallpaper_boot_option_theme_get)
}

wallpaper_boot_theme_dir_path_find_by_default () {
	## ~/.config/bspwm/wallpaper/theme/default
	wallpaper_boot_theme_dir_path_create $(wallpaper_boot_option_theme_default)
}

wallpaper_boot_theme_dir_path_create () {
	local theme_name="$1"

	## ~/.config/bspwm/wallpaper/theme/theme_name
	echo "$HOME/.config/bspwm/wallpaper/theme/$theme_name"
}

wallpaper_boot_option_theme_default () {
	echo 'default'
}

wallpaper_boot_option_theme_get () {


	wallpaper_sys_option_theme_file_check

	## ~/.config/bspwm/wallpaper/option/theme
	cat "$HOME/.config/bspwm/wallpaper/option/theme"
}

wallpaper_sys_option_theme_file_check () {

	if ! [ -e "$HOME/.config/bspwm/wallpaper/option/theme" ] ; then
		mkdir -p "$HOME/.config/bspwm/wallpaper/option"
		echo 'default' > "$HOME/.config/bspwm/wallpaper/option/theme"
	fi

}

##wallpaper_boot

__main__ () {

	##wallpaper_boot_simple
	##wallpaper_boot_default
	##wallpaper_boot_by_option

	wallpaper_boot_by_check_fehbg


}

__main__
